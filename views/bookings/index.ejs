<% layout("/layouts/boilerplate") %>

<style>
    .booking-card {
        border-left: 4px solid #667eea;
        transition: transform 0.2s;
    }
    .booking-card:hover {
        transform: translateX(5px);
    }
    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
    }
    .status-confirmed { background: #d4edda; color: #155724; }
    .status-pending { background: #fff3cd; color: #856404; }
    .status-cancelled { background: #f8d7da; color: #721c24; }
    .status-completed { background: #cce5ff; color: #004085; }
    .nav-pills .nav-link.active {
        background-color: #667eea;
    }
    .nav-pills .nav-link {
        color: #495057;
    }
</style>

<div class="container mt-4">
    <h2 class="mb-4">My Bookings</h2>
    
    <ul class="nav nav-pills mb-4">
        <li class="nav-item">
            <a class="nav-link <%= type === 'guest' ? 'active' : '' %>" href="/my-bookings">As Guest</a>
        </li>
        <li class="nav-item">
            <a class="nav-link <%= type === 'host' ? 'active' : '' %>" href="/host-bookings">As Host</a>
        </li>
    </ul>

    <% if(bookings.length > 0) { %>
        <% for(let booking of bookings) { %>
            <div class="card mb-3 booking-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <img src="<%= booking.listing.image.url %>" alt="listing" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">
                        </div>
                        <div class="col-md-6">
                            <h5><%= booking.listing.title %></h5>
                            <p class="mb-1 text-muted">
                                <i class="fas fa-map-marker-alt"></i> <%= booking.listing.location %>, <%= booking.listing.country %>
                            </p>
                            <p class="mb-1">
                                <i class="fas fa-calendar"></i> 
                                <%= new Date(booking.checkIn).toLocaleDateString() %> - 
                                <%= new Date(booking.checkOut).toLocaleDateString() %>
                            </p>
                            <p class="mb-0">
                                <i class="fas fa-users"></i> <%= booking.guests %> guests
                            </p>
                        </div>
                        <div class="col-md-2 text-center">
                            <span class="status-badge status-<%= booking.status %>"><%= booking.status %></span>
                            <p class="mt-2 mb-0"><strong>â‚¹<%= booking.totalPrice ? booking.totalPrice.toLocaleString() : 0 %></strong></p>
                        </div>
                        <div class="col-md-2 text-right">
                            <a href="/bookings/<%= booking._id %>" class="btn btn-outline-primary btn-sm">View Details</a>
                            <% if(type === 'guest' && booking.status !== 'cancelled') { %>
                                <form action="/bookings/<%= booking._id %>/cancel" method="POST" class="mt-2">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">Cancel</button>
                                </form>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    <% } else { %>
        <div class="text-center py-5">
            <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
            <h4>No bookings found</h4>
            <p class="text-muted">Start exploring listings to make your first booking!</p>
            <a href="/listings" class="btn btn-primary">Browse Listings</a>
        </div>
    <% } %>
</div>
